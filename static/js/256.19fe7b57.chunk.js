"use strict";(self.webpackChunkpatanjali_koramangala=self.webpackChunkpatanjali_koramangala||[]).push([[256],{256:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var o=t(555),n=t(43),l=t(216),c=t(722),s=t(579);const r="Radha";function d(){const[e,a]=(0,n.useState)(["All"]),[t,d]=(0,n.useState)(""),[i,p]=(0,n.useState)("All"),[u,m]=(0,n.useState)([]),g=(0,l.Zp)();(0,n.useEffect)(()=>{(async()=>{try{const e="http://localhost:5001";alert("\ud83e\udde9 Using backend: ".concat(e));const t=(await c.A.get("".concat(e,"/api/getImages"))).data,o=[],n=new Set(["All"]);for(const a in t){const e=t[a],l=a.replace("".concat(r,"/"),"")||"All";e.forEach(e=>{const a=e.id||e.asset_id||Date.now(),t=e.name||(e.public_id?e.public_id.split("/").pop():"unknown"),n=e.url||e.secure_url||e.url_secure||"",c=e.context||{},s=c.custom&&"object"===typeof c.custom?c.custom:"object"===typeof c&&"string"===typeof c.custom?c.custom.split("|").reduce((e,a)=>{const[t,o]=a.split("=");return t&&(e[t]=null!==o&&void 0!==o?o:""),e},{}):{};o.push({id:a,name:t,image:n,category:l,uploaded:!0,price:s.price||"",qty:s.qty||"",description:s.description||"",file:null})}),n.add(l)}m(o),a([...n]),console.log("Fetched Cloudinary images:",o)}catch(e){console.error("Failed to fetch Cloudinary images:",e),alert("Error fetching images. Check console for details.")}})()},[]);const h=(e,a,t)=>{m(n=>n.map(n=>n.id===e?(0,o.A)((0,o.A)({},n),{},{[a]:t}):n))},x=e.reduce((e,a)=>(e[a]=u.filter(e=>e.category===a),e),{});return(0,s.jsxs)("div",{className:"p-8 bg-green-50 min-h-screen",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-green-700",children:"Admin Dashboard"}),(0,s.jsx)("button",{onClick:()=>{g("/")},className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Logout"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,s.jsx)("input",{value:t,onChange:e=>d(e.target.value),placeholder:"New Category",className:"border p-2 rounded w-64"}),(0,s.jsx)("button",{onClick:()=>{t&&!e.includes(t)&&(a([...e,t]),d(""))},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Add Category"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,s.jsx)("select",{onChange:e=>p(e.target.value),className:"border p-2 rounded",value:i,children:e.map(e=>(0,s.jsx)("option",{children:e},e))}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(!a)return;const t=new FileReader;t.onloadend=()=>{const e={id:Date.now(),name:a.name,price:"",qty:"",description:"",category:i,image:t.result,uploaded:!1,file:a};m(a=>[...a,e])},t.readAsDataURL(a)},className:"border p-2 rounded"})]}),u.some(e=>!e.uploaded)&&(0,s.jsx)("button",{onClick:async()=>{if(0===u.length)return alert("No images to upload!");const e=[...u],a={};e.forEach((e,t)=>{if(!e.uploaded&&e.file){var n;const l=(null===(n=e.category)||void 0===n?void 0:n.trim().replace(/\s+/g,"_"))||"Uncategorized";a[l]||(a[l]=[]),a[l].push((0,o.A)((0,o.A)({},e),{},{index:t}))}});for(const o in a){const d=a[o];for(const{file:a,name:i,price:p,qty:u,description:m,index:g}of d)try{const t="".concat(r,"/").concat(o),n=i.replace(/\.[^/.]+$/,""),l=await c.A.get("".concat("http://localhost:5001","/api/signature?folder=").concat(encodeURIComponent(t),"&public_id=").concat(encodeURIComponent(n))),{signature:s,timestamp:d,apiKey:h,cloudName:x}=l.data,b=new FormData;b.append("file",a),b.append("folder",t),b.append("public_id",n),b.append("api_key",h),b.append("timestamp",d),b.append("signature",s);const f="price=".concat(p,"|qty=").concat(u,"|description=").concat(m);b.append("context",f);const v=await c.A.post("https://api.cloudinary.com/v1_1/".concat(x,"/image/upload"),b);e[g].image=v.data.secure_url,e[g].uploaded=!0,console.log("\u2705 Uploaded successfully: ".concat(i," \u2192 ").concat(t))}catch(s){var t,n,l;const e=(null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n||null===(l=n.error)||void 0===l?void 0:l.message)||s.message;console.error("\u274c Failed to upload ".concat(i,": ").concat(e)),alert('Failed to upload "'.concat(i,'": ').concat(e))}}m(e),alert("\u2705 All images uploaded successfully!")},className:"mb-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Upload All to Cloudinary"}),e.map(e=>{var a;return(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-green-800 mb-3",children:e}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:null===(a=x[e])||void 0===a?void 0:a.map(e=>(0,s.jsxs)("div",{className:"p-4 bg-white rounded-xl shadow hover:shadow-lg transition",children:[e.image&&(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-full h-40 object-cover rounded mb-3"}),(0,s.jsx)("p",{className:"font-bold text-lg",children:e.name}),(0,s.jsx)("input",{type:"text",placeholder:"Price",value:e.price,onChange:a=>h(e.id,"price",a.target.value),className:"border p-1 rounded w-full mb-2"}),(0,s.jsx)("input",{type:"number",placeholder:"Quantity",value:e.qty,onChange:a=>h(e.id,"qty",a.target.value),className:"border p-1 rounded w-full mb-2"}),(0,s.jsx)("textarea",{placeholder:"Description",value:e.description,onChange:a=>h(e.id,"description",a.target.value),className:"border p-1 rounded w-full mb-2"}),(0,s.jsxs)("p",{className:"text-sm text-green-700 mt-1",children:["Category: ",e.category]}),e.uploaded?(0,s.jsx)("span",{className:"text-xs text-blue-600",children:"Uploaded"}):(0,s.jsx)("span",{className:"text-xs text-orange-600",children:"Not uploaded"}),(0,s.jsx)("button",{onClick:()=>{return a=e.id,void m(u.filter(e=>e.id!==a));var a},className:"mt-3 bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"Delete"})]},e.id))})]},e)})]})}}}]);
//# sourceMappingURL=256.19fe7b57.chunk.js.map
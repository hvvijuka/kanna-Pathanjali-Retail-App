"use strict";(self.webpackChunkpatanjali_koramangala=self.webpackChunkpatanjali_koramangala||[]).push([[256],{256:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var o=t(555),n=t(43),l=t(216),c=t(722),s=t(579);const r="Radha";function d(){const[e,a]=(0,n.useState)(["All"]),[t,d]=(0,n.useState)(""),[i,p]=(0,n.useState)("All"),[u,g]=(0,n.useState)([]),[m,h]=(0,n.useState)(null),x=(0,l.Zp)();(0,n.useEffect)(()=>{(async()=>{try{const e="http://localhost:5001";console.log("\ud83e\udde9 Using backend: ".concat(e));const t=(await c.A.get("".concat(e,"/api/getImages"))).data,o=[],n=new Set(["All"]);for(const a in t){const e=t[a],l=a.replace(/^Radha\//,"")||"All";e.forEach(e=>{var a;const t=e.asset_id||Date.now()+Math.random(),n=e.original_filename||(null===(a=e.public_id)||void 0===a?void 0:a.split("/").pop())||"unknown",c=e.secure_url||e.url||"";let s="",r="",d="";if(e.context){const a=e.context.custom||e.context;"object"===typeof a?(s=a.price||"",r=a.qty||"",d=a.description||""):"string"===typeof a&&a.split("|").forEach(e=>{const[a,t]=e.split("=");"price"===a&&(s=t),"qty"===a&&(r=t),"description"===a&&(d=t)})}o.push({id:t,name:n,image:c,category:l,uploaded:!0,price:s,qty:r,description:d})}),n.add(l)}g(o),a([...n]),console.log("\u2705 Fetched Cloudinary images:",o)}catch(e){console.error("\u274c Failed to fetch Cloudinary images:",e),alert("Error fetching images. Check console for details.")}})()},[]);const b=(e,a,t)=>{g(n=>n.map(n=>n.id===e?(0,o.A)((0,o.A)({},n),{},{[a]:t}):n))},f=e.reduce((e,a)=>(e[a]=u.filter(e=>e.category===a),e),{});return(0,s.jsxs)("div",{className:"p-8 bg-green-50 min-h-screen",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-green-700",children:"Admin Dashboard"}),(0,s.jsx)("button",{onClick:()=>{x("/")},className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Logout"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,s.jsx)("input",{value:t,onChange:e=>d(e.target.value),placeholder:"New Category",className:"border p-2 rounded w-64"}),(0,s.jsx)("button",{onClick:()=>{t&&!e.includes(t)&&(a([...e,t]),d(""))},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Add Category"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,s.jsx)("select",{onChange:e=>p(e.target.value),className:"border p-2 rounded",value:i,children:e.map(e=>(0,s.jsx)("option",{children:e},e))}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(!a)return;const t=new FileReader;t.onloadend=()=>{const e={id:Date.now(),name:a.name,price:"",qty:"",description:"",category:i,image:t.result,uploaded:!1,file:a};g(a=>[...a,e]),h(e.id)},t.readAsDataURL(a)},className:"border p-2 rounded"})]}),u.some(e=>!e.uploaded)&&(0,s.jsx)("button",{onClick:async()=>{if(0===u.length)return alert("No images to upload!");const e=[...u],a={};e.forEach((e,t)=>{if(!e.uploaded&&e.file){var n;const l=(null===(n=e.category)||void 0===n?void 0:n.trim().replace(/\s+/g,"_"))||"Uncategorized";a[l]||(a[l]=[]),a[l].push((0,o.A)((0,o.A)({},e),{},{index:t}))}});for(const o in a){const d=a[o];for(const{file:a,name:i,price:p,qty:u,description:g,index:m}of d)try{const t="".concat(r,"/").concat(o),n=i.replace(/\.[^/.]+$/,""),l="price=".concat(p,"|qty=").concat(u,"|description=").concat(g),s=await c.A.get("".concat("http://localhost:5001","/api/signature?folder=").concat(encodeURIComponent(t),"&public_id=").concat(encodeURIComponent(n),"&context=").concat(encodeURIComponent(l))),{signature:d,timestamp:h,apiKey:x,cloudName:b}=s.data,f=new FormData;f.append("file",a),f.append("folder",t),f.append("public_id",n),f.append("api_key",x),f.append("timestamp",h),f.append("signature",d),f.append("context",l);const v=await c.A.post("https://api.cloudinary.com/v1_1/".concat(b,"/image/upload"),f);e[m].image=v.data.secure_url,e[m].uploaded=!0,console.log("\u2705 Uploaded successfully: ".concat(i," \u2192 ").concat(t))}catch(s){var t,n,l;const e=(null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n||null===(l=n.error)||void 0===l?void 0:l.message)||s.message;console.error("\u274c Failed to upload ".concat(i,": ").concat(e)),alert('Failed to upload "'.concat(i,'": ').concat(e))}}g(e),alert("\u2705 All images uploaded successfully!")},className:"mb-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Upload All to Cloudinary"}),e.map(e=>{var a;return(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-green-800 mb-3",children:e}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:null===(a=f[e])||void 0===a?void 0:a.map(e=>{const a=m===e.id;return(0,s.jsxs)("div",{className:"p-4 bg-white rounded-xl shadow hover:shadow-lg transition",children:[e.image&&(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-full h-40 object-cover rounded mb-3"}),(0,s.jsx)("p",{className:"font-bold text-lg",children:e.name}),(0,s.jsx)("input",{type:"text",placeholder:"Price",value:e.price,disabled:!a,onChange:a=>b(e.id,"price",a.target.value),className:"border p-1 rounded w-full mb-2 ".concat(a?"bg-white":"bg-gray-100")}),(0,s.jsx)("input",{type:"number",placeholder:"Quantity",value:e.qty,disabled:!a,onChange:a=>b(e.id,"qty",a.target.value),className:"border p-1 rounded w-full mb-2 ".concat(a?"bg-white":"bg-gray-100")}),(0,s.jsx)("textarea",{placeholder:"Description",value:e.description,disabled:!a,onChange:a=>b(e.id,"description",a.target.value),className:"border p-1 rounded w-full mb-2 ".concat(a?"bg-white":"bg-gray-100")}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("p",{className:"text-sm text-green-700",children:["Category: ",e.category]}),e.uploaded?(0,s.jsx)("span",{className:"text-xs text-blue-600",children:"Uploaded"}):(0,s.jsx)("span",{className:"text-xs text-orange-600",children:"Not uploaded"})]}),(0,s.jsxs)("div",{className:"flex justify-between mt-3",children:[(0,s.jsx)("button",{onClick:()=>{return a=e.id,void h(e=>e===a?null:a);var a},className:"px-3 py-1 rounded text-white ".concat(a?"bg-green-600 hover:bg-green-700":"bg-yellow-500 hover:bg-yellow-600"),children:a?"Save":"Edit"}),(0,s.jsx)("button",{onClick:()=>{return a=e.id,g(u.filter(e=>e.id!==a)),void(m===a&&h(null));var a},className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"Delete"})]})]},e.id)})})]},e)})]})}}}]);
//# sourceMappingURL=256.2e25804b.chunk.js.map
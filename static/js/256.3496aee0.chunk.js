"use strict";(self.webpackChunkpatanjali_koramangala=self.webpackChunkpatanjali_koramangala||[]).push([[256],{256:(e,a,t)=>{t.r(a),t.d(a,{default:()=>s});var n=t(555),o=t(43),c=t(216),i=t(722),l=t(579);const d="Radha";function s(){const[e,a]=(0,o.useState)(["All"]),[t,s]=(0,o.useState)(""),[r,p]=(0,o.useState)("All"),[u,m]=(0,o.useState)([]),[g,h]=(0,o.useState)(null),[b,x]=(0,o.useState)(!1),f=(0,c.Zp)();(0,o.useEffect)(()=>{(async()=>{try{const e="http://localhost:5001";console.log("\ud83e\udde9 Using backend: ".concat(e));const t=(await i.A.get("".concat(e,"/api/getImages"))).data,n=[],o=new Set(["All"]);for(const a in t){const e=t[a],c=a.replace(/^Radha\//,"")||"All";e.forEach(e=>{var a;const t=e.asset_id||Date.now()+Math.random(),o=e.original_filename||(null===(a=e.public_id)||void 0===a?void 0:a.split("/").pop())||"unknown",i=e.secure_url||e.url||"",l=e.public_id;let d="",s="",r="";if(e.context){const a=e.context.custom||e.context;"object"===typeof a?(d=a.price||"",s=a.qty||"",r=a.description||""):"string"===typeof a&&a.split("|").forEach(e=>{const[a,t]=e.split("=");"price"===a&&(d=t),"qty"===a&&(s=t),"description"===a&&(r=t)})}n.push({id:t,name:o,image:i,category:c,uploaded:!0,price:d,qty:s,description:r,public_id:l,edited:!1})}),o.add(c)}m(n),a([...o]),console.log("\u2705 Fetched Cloudinary images:",n)}catch(e){console.error("\u274c Failed to fetch Cloudinary images:",e),alert("Error fetching images. Check console for details.")}})()},[]);const y=(e,a,t)=>{m(o=>o.map(o=>o.id===e?(0,n.A)((0,n.A)({},o),{},{[a]:t,edited:!0}):o)),x(!0)},v=e.reduce((e,a)=>(e[a]=u.filter(e=>e.category===a),e),{});return(0,l.jsxs)("div",{className:"p-8 bg-green-50 min-h-screen",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-green-700",children:"Admin Dashboard"}),(0,l.jsx)("button",{onClick:()=>{f("/")},className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Logout"})]}),(0,l.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,l.jsx)("input",{value:t,onChange:e=>s(e.target.value),placeholder:"New Category",className:"border p-2 rounded w-64"}),(0,l.jsx)("button",{onClick:()=>{t&&!e.includes(t)&&(a([...e,t]),s(""))},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Add Category"})]}),(0,l.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,l.jsx)("select",{onChange:e=>p(e.target.value),className:"border p-2 rounded",value:r,children:e.map(e=>(0,l.jsx)("option",{children:e},e))}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(!a)return;const t=new FileReader;t.onloadend=()=>{const e={id:Date.now(),name:a.name,price:"",qty:"",description:"",category:r,image:t.result,uploaded:!1,file:a};m(a=>[...a,e]),h(e.id)},t.readAsDataURL(a)},className:"border p-2 rounded"})]}),(u.some(e=>!e.uploaded)||b)&&(0,l.jsx)("button",{onClick:async()=>{if(0===u.length)return alert("No images to upload!");const e=[...u],a="http://localhost:5001",t={};e.forEach((e,a)=>{if(!e.uploaded&&e.file||e.edited){var o;const c=(null===(o=e.category)||void 0===o?void 0:o.trim().replace(/\s+/g,"_"))||"Uncategorized";t[c]||(t[c]=[]),t[c].push((0,n.A)((0,n.A)({},e),{},{index:a}))}});for(const n in t){const r=t[n];for(const t of r){const{file:r,name:p,price:u,qty:m,description:g,index:h,public_id:b}=t;try{if(!p&&!r){console.warn("\u26a0\ufe0f Skipping item with missing name and no file");continue}const t="".concat(d,"/").concat(n),o=p?p.replace(/\.[^/.]+$/,""):"unnamed_".concat(Date.now()),c="price=".concat(u||"","|qty=").concat(m||"","|description=").concat(g||""),l=b||"".concat(t,"/").concat(o),s=r?"".concat(a,"/api/signature?folder=").concat(encodeURIComponent(t),"&public_id=").concat(encodeURIComponent(o),"&context=").concat(encodeURIComponent(c),"&type=upload"):"".concat(a,"/api/signature?public_id=").concat(encodeURIComponent(l),"&context=").concat(encodeURIComponent(c),"&type=upload"),x=await i.A.get(s),{signature:f,timestamp:y,apiKey:v,cloudName:w}=x.data;if(r){const a=new FormData;a.append("file",r),a.append("folder",t),a.append("public_id",o),a.append("api_key",v),a.append("timestamp",y),a.append("signature",f),a.append("context",c);const n=await i.A.post("https://api.cloudinary.com/v1_1/".concat(w,"/image/upload"),a);e[h].image=n.data.secure_url,e[h].public_id=n.data.public_id,console.log("\u2705 Uploaded successfully: ".concat(p," \u2192 ").concat(t))}else{if(!e[h].public_id){console.warn("\u26a0\ufe0f Skipping metadata update: ".concat(p," has no public_id yet"));continue}const a=new FormData;a.append("public_id",e[h].public_id),a.append("type","upload"),a.append("context",c),a.append("api_key",v),a.append("timestamp",y),a.append("signature",f),await i.A.post("https://api.cloudinary.com/v1_1/".concat(w,"/image/explicit"),a),console.log("\ud83d\udcdd Updated metadata for: ".concat(p))}e[h].uploaded=!0,e[h].edited=!1}catch(s){var o,c,l;const e=(null===(o=s.response)||void 0===o||null===(c=o.data)||void 0===c||null===(l=c.error)||void 0===l?void 0:l.message)||s.message;console.error("\u274c Failed to upload ".concat(p,": ").concat(e)),alert('Failed to upload "'.concat(p,'": ').concat(e))}}}m(e),x(!1),alert("\u2705 All uploads & edits saved successfully!")},className:"mb-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:b?"Update Edited Items to Cloudinary":"Upload All to Cloudinary"}),e.map(e=>{var a;return(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-green-800 mb-3",children:e}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:null===(a=v[e])||void 0===a?void 0:a.map(e=>{const a=g===e.id;return(0,l.jsxs)("div",{className:"p-4 bg-white rounded-xl shadow hover:shadow-lg transition",children:[e.image&&(0,l.jsx)("img",{src:e.image,alt:e.name,className:"w-full h-40 object-cover rounded mb-3"}),(0,l.jsx)("p",{className:"font-bold text-lg",children:e.name}),(0,l.jsx)("input",{type:"text",placeholder:"Price",value:e.price,disabled:!a,onChange:a=>y(e.id,"price",a.target.value),className:"border p-1 rounded w-full mb-2 ".concat(a?"bg-white":"bg-gray-100")}),(0,l.jsx)("input",{type:"number",placeholder:"Quantity",value:e.qty,disabled:!a,onChange:a=>y(e.id,"qty",a.target.value),className:"border p-1 rounded w-full mb-2 ".concat(a?"bg-white":"bg-gray-100")}),(0,l.jsx)("textarea",{placeholder:"Description",value:e.description,disabled:!a,onChange:a=>y(e.id,"description",a.target.value),className:"border p-1 rounded w-full mb-2 ".concat(a?"bg-white":"bg-gray-100")}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("p",{className:"text-sm text-green-700",children:["Category: ",e.category]}),e.uploaded?(0,l.jsx)("span",{className:"text-xs text-blue-600",children:"Uploaded"}):(0,l.jsx)("span",{className:"text-xs text-orange-600",children:"Not uploaded"})]}),(0,l.jsxs)("div",{className:"flex justify-between mt-3",children:[(0,l.jsx)("button",{onClick:()=>{return a=e.id,void h(e=>e===a?null:a);var a},className:"px-3 py-1 rounded text-white ".concat(a?"bg-green-600 hover:bg-green-700":"bg-yellow-500 hover:bg-yellow-600"),children:a?"Save":"Edit"}),(0,l.jsx)("button",{onClick:()=>{return a=e.id,m(u.filter(e=>e.id!==a)),void(g===a&&h(null));var a},className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"Delete"})]})]},e.id)})})]},e)})]})}}}]);
//# sourceMappingURL=256.3496aee0.chunk.js.map